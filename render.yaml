services:
  # PostgreSQL Database (CREATE THIS FIRST)
  - type: pgsql
    name: trading-robot-db
    region: oregon
    databaseName: trading_admin
    user: trading_admin_user
    plan: starter

  # Web Service (CREATE AFTER DATABASE)
  - type: web
    name: trading-robot-admin
    runtime: docker
    region: oregon  # SAME REGION AS DATABASE
    
    # ðŸ”¥ CRITICAL: Add these environment variables
    envVars:
      - key: DJANGO_SETTINGS_MODULE
        value: trading_admin.settings_render
      - key: SECRET_KEY
        generateValue: true
      - key: DEBUG
        value: false
      # ðŸš€ THIS IS THE KEY - Connect to your database:
      - key: DATABASE_URL
        fromService:
          type: pgsql
          name: trading-robot-db
          property: connectionString
    
    buildCommand: |
      pip install --upgrade pip
      pip install -r requirements.txt
      python manage.py collectstatic --noinput
      python manage.py migrate --noinput
      python manage.py reset_and_setup \
        --username yousef \
        --password admin123123 \
        --email admin@example.com \
        --force